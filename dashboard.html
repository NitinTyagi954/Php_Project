<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volunteer Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1b3c59',
                        'primary-dark': '#142d44',
                        secondary: '#1b3c59',
                        tertiary: '#1b3c59',
                        background: '#eaf6fb',
                        'border-light': '#d0e4f1',
                        'hover-text': '#3498db'
                    }
                }
            }
        }
    </script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .message {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            padding: 1rem 2rem;
            border-radius: 0.75rem;
            z-index: 1000;
            background: white;
            border: 1px solid #d0e4f1;
            box-shadow: 0 8px 16px rgba(208, 228, 241, 0.3);
            transition: all 0.3s ease;
            font-weight: 500;
        }
        .message.error {
            color: #991b1b;
            border: 2px solid #f87171;
            background: #fef2f2;
        }
        .message.success {
            color: #166534;
            border: 2px solid #4ade80;
            background: #f0fdf4;
        }
        .card-hover {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            background: linear-gradient(135deg, #ffffff 0%, #eaf6fb 100%);
            border: 1px solid #d0e4f1;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(208, 228, 241, 0.3);
        }
        .nav-link {
            transition: all 0.2s ease;
        }
        .nav-link:hover {
            color: #3498db;
            border-radius: 0.5rem;
        }
        .section-heading {
            background: linear-gradient(to right, #1b3c59, #3498db);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }
        .container {
            max-width: 80rem;
            margin-left: auto;
            margin-right: auto;
            padding-left: 1rem;
            padding-right: 1rem;
        }
        .sidebar {
            position: sticky;
            top: 5rem;
            height: calc(100vh - 5rem);
            overflow-y: auto;
        }
        .glass-effect {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(234, 246, 251, 0.9) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid #d0e4f1;
        }
        .scroll-reveal {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease, transform 0.6s ease;
        }
        .scroll-reveal.visible {
            opacity: 1;
            transform: translateY(0);
        }
        @media (max-width: 767px) {
            .sidebar {
                position: static;
                height: auto;
            }
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-background to-white font-sans antialiased">
    <div id="message" class="message hidden"></div>
    
    <nav class="bg-white shadow-lg fixed w-full z-20 top-0 border-b border-border-light">
        <div class="container px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center space-x-6">
                    <div class="flex items-center">
                        <i class="fas fa-hands-helping text-primary text-2xl mr-2"></i>
                        <h1 class="text-xl font-bold text-tertiary">Volunteer Hub</h1>
                    </div>
                    <div class="hidden md:flex space-x-2">
                        <a href="dashboard.html" class="nav-link text-tertiary px-3 py-2 text-sm font-medium flex items-center border-b-2 border-primary">
                            <i class="fas fa-home mr-2"></i>Dashboard
                        </a>
                        <a href="#about" class="nav-link text-tertiary px-3 py-2 text-sm font-medium flex items-center">
                            <i class="fas fa-info-circle mr-2"></i>About
                        </a>
                        <a href="team.html" class="nav-link text-tertiary px-3 py-2 text-sm font-medium flex items-center">
                            <i class="fas fa-users mr-2"></i>Our Team
                        </a>
                        <a href="#contact" class="nav-link text-tertiary px-3 py-2 text-sm font-medium flex items-center">
                            <i class="fas fa-envelope mr-2"></i>Contact
                        </a>
                        <a href="#faq" class="nav-link text-tertiary px-3 py-2 text-sm font-medium flex items-center">
                            <i class="fas fa-question-circle mr-2"></i>FAQ
                        </a>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button id="profileBtn" class="nav-link text-tertiary px-3 py-2 text-sm font-medium flex items-center">
                        <i class="fas fa-user mr-2"></i>Profile
                    </button>
                    <button id="logoutBtn" class="bg-primary text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-primary-dark transition-colors">
                        <i class="fas fa-sign-out-alt mr-2"></i>Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="container pt-24 pb-12">
        <div class="flex flex-col md:flex-row gap-8">
            <!-- Sidebar -->
            <div class="md:w-1/4 scroll-reveal">
                <div class="sidebar">
                    <div class="bg-white rounded-xl shadow-md p-6 card-hover">
                        <h2 class="text-xl font-bold mb-6 section-heading">Your Impact</h2>
                        <div class="space-y-4">
                            <div class="flex items-center p-4 bg-gray-50 rounded-lg hover:bg-blue-50 transition-colors">
                                <i class="fas fa-calendar-check text-primary text-2xl mr-4"></i>
                                <div>
                                    <p class="text-gray-600 text-sm">Events Attended</p>
                                    <p class="text-2xl font-bold text-tertiary" id="totalEvents">0</p>
                                </div>
                            </div>
                            <div class="flex items-center p-4 bg-gray-50 rounded-lg hover:bg-blue-50 transition-colors">
                                <i class="fas fa-clock text-primary text-2xl mr-4"></i>
                                <div>
                                    <p class="text-gray-600 text-sm">Total Hours</p>
                                    <p class="text-2xl font-bold text-tertiary" id="totalHours">0</p>
                                </div>
                            </div>
                            <div class="flex items-center p-4 bg-gray-50 rounded-lg hover:bg-blue-50 transition-colors">
                                <i class="fas fa-star text-primary text-2xl mr-4"></i>
                                <div>
                                    <p class="text-gray-600 text-sm">Impact Score</p>
                                    <p class="text-2xl font-bold text-tertiary" id="impactScore">0</p>
                                </div>
                            </div>
                            <div class="flex items-center p-4 bg-gray-50 rounded-lg hover:bg-blue-50 transition-colors">
                                <i class="fas fa-calendar-day text-primary text-2xl mr-4"></i>
                                <div>
                                    <p class="text-gray-600 text-sm">Total Days</p>
                                    <p class="text-2xl font-bold text-tertiary" id="totalDays">0</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="md:w-3/4 space-y-8">
                <!-- Upcoming Events -->
                <div class="bg-white rounded-xl shadow-md p-6 card-hover scroll-reveal">
                    <h2 class="text-xl font-bold mb-6 section-heading">Upcoming Events</h2>
                    <div id="eventsList" class="space-y-4"></div>
                </div>

                <!-- Your Events -->
                <div class="bg-white rounded-xl shadow-md p-6 card-hover scroll-reveal">
                    <h anarcho="text-xl font-bold mb-6 section-heading">Your Events</h2>
                    <div id="userEvents" class="space-y-4"></div>
                </div>

                <!-- Event Members -->
                <div class="glass-effect rounded-xl shadow-md p-6 card-hover scroll-reveal">
                    <h2 class="text-xl font-bold mb-6 section-heading">Event Members</h2>
                    <div id="eventMembers" class="space-y-4">
                        <div class="text-gray-600 text-center py-8">
                            <i class="fas fa-users text-4xl text-gray-300 mb-4"></i>
                            <p class="text-gray-600">Select an event to view registered members</p>
                        </div>
                    </div>
                </div>

                <!-- About Us Section -->
                <div id="about" class="bg-white rounded-xl shadow-md p-6 card-hover scroll-reveal">
                    <h2 class="text-xl font-bold mb-6 section-heading">About Our Organization</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-lg font-semibold text-tertiary mb-4">Our Mission</h3>
                            <p class="text-gray-600 mb-6">We are dedicated to creating positive change in our community through volunteer work and community engagement. Our mission is to connect passionate individuals with meaningful opportunities to make a difference.</p>
                            <div class="space-y-4">
                                <div class="flex items-center">
                                    <i class="fas fa-heart text-primary text-lg mr-3"></i>
                                    <span class="text-gray-600">1000+ Volunteers</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-calendar-check text-primary text-lg mr-3"></i>
                                    <span class="text-gray-600">500+ Events Organized</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-hand-holding-heart text-primary text-lg mr-3"></i>
                                    <span class="text-gray-600">50+ Community Partners</span>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-tertiary mb-4">Our Impact</h3>
                            <div class="space-y-4">
                                <div class="bg-gray-50 p-4 rounded-lg hover:bg-blue-50 transition-colors">
                                    <h4 class="font-medium text-tertiary mb-2">Community Development</h4>
                                    <p class="text-gray-600">We've helped improve local communities through various initiatives and programs.</p>
                                </div>
                                <div class="bg-gray-50 p-4 rounded-lg hover:bg-blue-50 transition-colors">
                                    <h4 class="font-medium text-tertiary mb-2">Environmental Conservation</h4>
                                    <p class="text-gray-600">Our volunteers have contributed to numerous environmental protection projects.</p>
                                </div>
                                <div class="bg-gray-50 p-4 rounded-lg hover:bg-blue-50 transition-colors">
                                    <h4 class="font-medium text-tertiary mb-2">Education Support</h4>
                                    <p class="text-gray-600">We provide educational support and resources to underprivileged communities.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contact Us Section -->
                <div id="contact" class="bg-white rounded-xl shadow-md p-6 card-hover scroll-reveal">
                    <h2 class="text-xl font-bold mb-6 section-heading">Contact Us</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-lg font-semibold text-tertiary mb-4">Get in Touch</h3>
                            <div class="space-y-4">
                                <div class="flex items-center">
                                    <i class="fas fa-map-marker-alt text-primary text-lg mr-3"></i>
                                    <span class="text-gray-600">Bh5, Lovely Professional University, Phagwara</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-phone text-primary text-lg mr-3"></i>
                                    <span class="text-gray-600">7982120177</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-envelope text-primary text-lg mr-3"></i>
                                    <span class="text-gray-600">Nitintyagi7982@gmail.com</span>
                                </div>
                            </div>
                            <div class="mt-6">
                                <h4 class="font-medium text-tertiary mb-3">Follow Us</h4>
                                <div class="flex space-x-4">
                                    <a href="https://www.instagram.com/nitintyagi954/?next=%2F" target="_blank" class="text-gray-600 hover:text-blue-600 transition-colors">
                                        <i class="fab fa-facebook text-xl"></i>
                                    </a>
                                    <a href="https://www.instagram.com/nitintyagi954/?next=%2F" target="_blank" class="text-gray-600 hover:text-blue-400 transition-colors">
                                        <i class="fab fa-twitter text-xl"></i>
                                    </a>
                                    <a href="https://www.instagram.com/nitintyagi954/?next=%2F" target="_blank" class="text-gray-600 hover:text-pink-600 transition-colors">
                                        <i class="fab fa-instagram text-xl"></i>
                                    </a>
                                    <a href="https://www.instagram.com/nitintyagi954/?next=%2F" target="_blank" class="text-gray-600 hover:text-blue-700 transition-colors">
                                        <i class="fab fa-youtube text-xl"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-tertiary mb-4">Send us a Message</h3>
                            <form class="space-y-4">
                                <div>
                                    <label class="block text-gray-600 mb-2">Name</label>
                                    <input type="text" name="name" class="w-full px-4 py-2 border border-border-light rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-gray-600 mb-2">Email</label>
                                    <input type="email" name="email" class="w-full px-4 py-2 border border-border-light rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-gray-600 mb-2">Message</label>
                                    <textarea name="message" class="w-full px-4 py-2 border border-border-light rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" rows="4"></textarea>
                                </div>
                                <button type="submit" class="bg-primary text-white px-6 py-2 rounded-md hover:bg-primary-dark transition-colors">
                                    Send Message
                                </button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- FAQ Section -->
                <div id="faq" class="bg-white rounded-xl shadow-md p-6 card-hover scroll-reveal">
                    <h2 class="text-xl font-bold mb-6 section-heading">Frequently Asked Questions</h2>
                    <div class="space-y-4">
                        <div class="border border-border-light rounded-lg p-4 hover:bg-gray-50 transition-colors">
                            <h3 class="font-semibold text-tertiary mb-2">How do I register for an event?</h3>
                            <p class="text-gray-600">You can register for events through the Events section on your dashboard. Simply click on the event you're interested in and follow the registration process.</p>
                        </div>
                        <div class="border border-border-light rounded-lg p-4 hover:bg-gray-50 transition-colors">
                            <h3 class="font-semibold text-tertiary mb-2">Can I cancel my event registration?</h3>
                            <p class="text-gray-600">Yes, you can cancel your registration through the "Your Events" section. Click on the event and select "Cancel Registration".</p>
                        </div>
                        <div class="border border-border-light rounded-lg p-4 hover:bg-gray-50 transition-colors">
                            <h3 class="font-semibold text-tertiary mb-2">How are impact scores calculated?</h3>
                            <p class="text-gray-600">Impact scores are calculated based on the number of hours you've volunteered and the type of events you've participated in.</p>
                        </div>
                        <div class="border border-border-light rounded-lg p-4 hover:bg-gray-50 transition-colors">
                            <h3 class="font-semibold text-tertiary mb-2">How can I get a certificate for my volunteer work?</h3>
                            <p class="text-gray-600">Certificates are automatically generated after you complete an event. You can find them in your profile section.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-white mt-16 border-t border-border-light">
        <div class="container py-8 px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-lg font-semibold text-tertiary mb-4">Volunteer Hub</h3>
                    <p class="text-gray-600">Making a difference together in our community.</p>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-tertiary mb-4">Quick Links</h3>
                    <ul class="space-y-2">
                        <li><a href="dashboard.html" class="text-gray-600 hover:text-primary">Home</a></li>
                        <li><a href="#about" class="text-gray-600 hover:text-primary">About</a></li>
                        <li><a href="team.html" class="text-gray-600 hover:text-primary">Our Team</a></li>
                        <li><a href="#contact" class="text-gray-600 hover:text-primary">Contact</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-tertiary mb-4">Connect With Us</h3>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-600 hover:text-primary text-xl">
                            <i class="fab fa-facebook"></i>
                        </a>
                        <a href="#" class="text-gray-600 hover:text-primary text-xl">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#" class="text-gray-600 hover:text-primary text-xl">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="#" class="text-gray-600 hover:text-primary text-xl">
                            <i class="fab fa-linkedin"></i>
                        </a>
                    </div>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-tertiary mb-4">Subscribe</h3>
                    <form class="flex">
                        <input type="email" placeholder="Your email" class="flex-grow px-4 py-2 border border-border-light rounded-l-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                        <button type="submit" class="bg-primary text-white px-4 py-2 rounded-r-md hover:bg-primary-dark transition-colors">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </form>
                </div>
            </div>
            <div class="mt-8 pt-6 border-t border-border-light text-center">
                <p class="text-gray-600">Â© 2025 Volunteer Hub. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        async function checkSession() {
            try {
                const response = await fetch('includes/check_session.php');
                const data = await response.json();
                if (!data.logged_in) {
                    window.location.href = 'index.html';
                }
            } catch (error) {
                console.error('Session check failed:', error);
                window.location.href = 'index.html';
            }
        }

        async function loadUserStats() {
            try {
                const response = await fetch('includes/get_user_stats.php');
                const data = await response.json();
                if (data.success) {
                    document.getElementById('totalEvents').textContent = data.stats.total_events;
                    document.getElementById('totalHours').textContent = data.stats.total_hours;
                    document.getElementById('impactScore').textContent = data.stats.impact_score;
                }
            } catch (error) {
                console.error('Failed to load user stats:', error);
            }
        }

        async function loadEvents() {
            try {
                const response = await fetch('includes/get_events.php');
                const data = await response.json();
                if (data.success) {
                    const eventsList = document.getElementById('eventsList');
                    eventsList.innerHTML = '';
                    
                    data.events.forEach(event => {
                        const eventCard = document.createElement('div');
                        eventCard.className = 'card-hover bg-gray-50 rounded-lg p-4';
                        eventCard.innerHTML = `
                            <div class="flex justify-between items-start">
                                <div>
                                    <h3 class="font-semibold text-tertiary text-lg">${event.title}</h3>
                                    <p class="text-gray-600 mt-1">${event.description}</p>
                                    <div class="mt-2 space-y-1">
                                        <p class="text-sm text-gray-600"><i class="far fa-calendar-alt mr-2"></i>${event.event_date}</p>
                                        <p class="text-sm text-gray-600"><i class="far fa-clock mr-2"></i>${event.start_time} - ${event.end_time}</p>
                                        <p class="text-sm text-gray-600"><i class="fas fa-map-marker-alt mr-2"></i>${event.location}</p>
                                        <p class="text-sm text-gray-600"><i class="fas fa-users mr-2"></i>${event.available_spots} spots available</p>
                                    </div>
                                </div>
                                <button onclick="registerForEvent(${event.id})" 
                                        class="bg-primary hover:bg-primary-dark text-white px-4 py-2 rounded-md transition-colors">
                                    Register
                                </button>
                            </div>
                        `;
                        eventsList.appendChild(eventCard);
                    });
                }
            } catch (error) {
                console.error('Failed to load events:', error);
            }
        }

        function loadUserEvents() {
            console.log('Loading user events...');
            fetch('includes/get_user_events.php')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Received events data:', data);
                    if (data.success) {
                        const eventsContainer = document.getElementById('userEvents');
                        if (data.events.length === 0) {
                            eventsContainer.innerHTML = `
                                <div class="text-center py-8">
                                    <p class="text-gray-600">You haven't registered for any events yet.</p>
                                    <a href="event_registration.html" class="mt-4 inline-block bg-primary text-white px-6 py-2 rounded-md hover:bg-primary-dark transition-colors">
                                        Browse Events
                                    </a>
                                </div>
                            `;
                            return;
                        }

                        let eventsHtml = '';
                        data.events.forEach(event => {
                            const eventDate = new Date(event.event_date);
                            const formattedDate = eventDate.toLocaleDateString('en-US', {
                                weekday: 'long',
                                year: 'numeric',
                                month: 'long',
                                day: 'numeric'
                            });

                            const startTime = new Date(`2000-01-01T${event.start_time}`);
                            const endTime = new Date(`2000-01-01T${event.end_time}`);
                            const formattedStartTime = startTime.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
                            const formattedEndTime = endTime.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });

                            const registrationDate = new Date(event.registration_date);
                            const formattedRegistrationDate = registrationDate.toLocaleDateString('en-US', {
                                year: 'numeric',
                                month: 'long',
                                day: 'numeric'
                            });

                            const statusClass = event.status === 'registered' ? 'bg-green-100 text-green-800' : 
                                             event.status === 'cancelled' ? 'bg-red-100 text-red-800' : 
                                             'bg-blue-100 text-blue-800';

                            eventsHtml += `
                                <div class="card-hover bg-white rounded-lg shadow-md p-6 mb-4 border border-border-light" id="event-${event.id}">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <h3 class="text-xl font-semibold text-tertiary">${event.title}</h3>
                                            <p class="text-gray-600 mt-1">${event.description}</p>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <span class="px-3 py-1 rounded-full text-sm font-medium ${statusClass}">
                                                ${event.status.charAt(0).toUpperCase() + event.status.slice(1)}
                                            </span>
                                            ${event.status === 'cancelled' ? `
                                                <button onclick="removeEvent(${event.id})" 
                                                        class="text-gray-400 hover:text-red-500 transition-colors">
                                                    <i class="fas fa-times-circle text-xl"></i>
                                                </button>
                                            ` : ''}
                                        </div>
                                    </div>
                                    <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <p class="text-gray-600"><span class="font-medium">Date:</span> ${formattedDate}</p>
                                            <p class="text-gray-600"><span class="font-medium">Time:</span> ${formattedStartTime} - ${formattedEndTime}</p>
                                            <p class="text-gray-600"><span class="font-medium">Location:</span> ${event.location}</p>
                                        </div>
                                        <div>
                                            <p class="text-gray-600"><span class="font-medium">Registered on:</span> ${formattedRegistrationDate}</p>
                                        </div>
                                    </div>
                                    <div class="mt-4 flex justify-end space-x-4">
                                        ${event.status === 'registered' ? `
                                        <button onclick="cancelEvent(${event.id})" class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition-colors">
                                            Cancel Registration
                                        </button>
                                        <button onclick="loadEventMembers(${event.id})" class="bg-primary text-white px-4 py-2 rounded-md hover:bg-primary-dark transition-colors">
                                            View Members
                                        </button>
                                        ` : ''}
                                    </div>
                                </div>
                            `;
                        });

                        eventsContainer.innerHTML = eventsHtml;
                    } else {
                        throw new Error(data.message || 'Failed to load events');
                    }
                })
                .catch(error => {
                    console.error('Error loading events:', error);
                    const eventsContainer = document.getElementById('userEvents');
                    if (eventsContainer) {
                        eventsContainer.innerHTML = `
                            <div class="text-center py-8">
                                <p class="text-red-600">Failed to load events. Please try again later.</p>
                                <button onclick="loadUserEvents()" class="mt-4 bg-primary text-white px-6 py-2 rounded-md hover:bg-primary-dark transition-colors">
                                    Retry
                                </button>
                            </div>
                        `;
                    }
                });
        }

        function registerForEvent(eventId) {
            window.location.href = `event_registration.html?event_id=${eventId}`;
        }

        async function cancelEvent(eventId) {
            if (!confirm('Are you sure you want to cancel this event?')) {
                return;
            }

            try {
                const response = await fetch('includes/cancel_event.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ event_id: eventId })
                });

                const data = await response.json();
                if (data.success) {
                    const eventCard = document.getElementById(`event-${eventId}`);
                    if (eventCard) {
                        eventCard.style.opacity = '0';
                        eventCard.style.transform = 'translateX(-100px)';
                        setTimeout(() => {
                            eventCard.remove();
                        }, 300);
                    }
                    loadUserStats();
                    showMessage('Event cancelled successfully', 'success');
                } else {
                    throw new Error(data.message || 'Failed to cancel event');
                }
            } catch (error) {
                console.error('Error cancelling event:', error);
                showMessage('Failed to cancel event. Please try again.', 'error');
            }
        }

        function showMessage(message, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = message;
            messageDiv.className = `message ${type}`;
            messageDiv.classList.remove('hidden');
            
            setTimeout(() => {
                messageDiv.classList.add('hidden');
            }, 3000);
        }

        document.getElementById('logoutBtn').addEventListener('click', async () => {
            try {
                const response = await fetch('includes/logout.php');
                const data = await response.json();
                if (data.success) {
                    window.location.href = 'index.html';
                } else {
                    throw new Error(data.message || 'Logout failed');
                }
            } catch (error) {
                console.error('Logout failed:', error);
                showMessage('Failed to logout. Please try again.', 'error');
            }
        });

        async function loadEventMembers(eventId) {
            console.log('Loading members for event:', eventId);
            try {
                const response = await fetch(`get_event_members.php?event_id=${eventId}`);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();
                console.log('Members data:', data);
                
                if (data.success) {
                    const membersContainer = document.getElementById('eventMembers');
                    if (data.members.length === 0) {
                        membersContainer.innerHTML = `
                            <div class="text-center py-8">
                                <i class="fas fa-users text-4xl text-gray-300 mb-4"></i>
                                <p class="text-gray-600">No members registered for this event yet</p>
                            </div>
                        `;
                        return;
                    }

                    membersContainer.innerHTML = `
                        <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                            <div class="flex items-center justify-center">
                                <i class="fas fa-users text-primary text-xl mr-3"></i>
                                <span class="text-lg font-medium text-tertiary">
                                    Total Members: ${data.total_members}
                                </span>
                            </div>
                        </div>
                        <div class="space-y-3">
                            ${data.members.map(member => displayMember(member)).join('')}
                        </div>
                    `;
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                console.error('Error loading event members:', error);
                const membersContainer = document.getElementById('eventMembers');
                membersContainer.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-exclamation-circle text-4xl text-gray-300 mb-4"></i>
                        <p class="text-gray-600">Failed to load event members: ${error.message}</p>
                    </div>
                `;
            }
        }

        function displayMember(member) {
            return `
                <div class="card-hover flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center mr-3">
                            <i class="fas fa-user text-primary"></i>
                        </div>
                        <div>
                            <p class="font-medium text-tertiary">${member.full_name}</p>
                            <p class="text-sm text-gray-600">${new Date(member.registration_date).toLocaleDateString()}</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function displayEvent(event) {
            const eventCard = document.createElement('div');
            eventCard.className = 'card-hover bg-white rounded-lg shadow-md p-6';
            eventCard.setAttribute('data-event-id', event.id);
            
            const statusClass = event.status === 'registered' ? 'text-green-600' : 
                               event.status === 'cancelled' ? 'text-red-600' : 
                               'text-gray-600';
            const statusText = event.status === 'registered' ? 'Registered' : 
                              event.status === 'cancelled' ? 'Cancelled' : 
                              'Pending';
            
            eventCard.innerHTML = `
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h3 class="text-xl font-semibold text-tertiary">${event.title}</h3>
                        <p class="text-gray-600">${event.location}</p>
                    </div>
                    <span class="px-3 py-1 rounded-full text-sm font-medium ${statusClass} bg-gray-100">
                        ${statusText}
                    </span>
                </div>
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="flex items-center">
                        <i class="fas fa-calendar-alt text-primary mr-2"></i>
                        <span class="text-gray-600">${new Date(event.date).toLocaleDateString()}</span>
                    </div>
                    <div class="flex items-center">
                        <i class="fas fa-clock text-primary mr-2"></i>
                        <span class="text-gray-600">${event.start_time} - ${event.end_time}</span>
                    </div>
                </div>
                <div class="flex justify-between items-center">
                    <div class="flex items-center">
                        <i class="fas fa-users text-primary mr-2"></i>
                        <span class="text-gray-600">${event.current_volunteers}/${event.max_volunteers} volunteers</span>
                    </div>
                    <div class="flex space-x-2">
                        ${event.status === 'registered' ? `
                            <button onclick="cancelEvent(${event.id})" 
                                    class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md transition-colors">
                                Cancel
                            </button>
                            <a href="event_members.html?event_id=${event.id}" 
                               class="bg-primary hover:bg-primary-dark text-white px-4 py-2 rounded-md transition-colors">
                                View Members
                            </a>
                        ` : ''}
                    </div>
                </div>
            `;
            
            return eventCard;
        }

        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        document.getElementById('profileBtn').addEventListener('click', () => {
            window.location.href = 'profile.html';
        });

        document.querySelector('#contact form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = {
                name: formData.get('name'),
                email: formData.get('email'),
                message: formData.get('message')
            };

            try {
                const response = await fetch('includes/send_contact.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                if (result.success) {
                    showMessage('Message sent successfully!', 'success');
                    e.target.reset();
                } else {
                    throw new Error(result.message || 'Failed to send message');
                }
            } catch (error) {
                showMessage(error.message, 'error');
            }
        });

        document.querySelectorAll('.social-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const platform = e.currentTarget.dataset.platform;
                const urls = {
                    facebook: 'https://facebook.com/volunteerportal',
                    twitter: 'https://twitter.com/volunteerportal',
                    instagram: 'https://instagram.com/volunteerportal',
                    youtube: 'https://youtube.com/volunteerportal'
                };
                window.open(urls[platform], '_blank');
            });
        });

        function removeEvent(eventId) {
            const eventCard = document.getElementById(`event-${eventId}`);
            if (eventCard) {
                eventCard.style.opacity = '0';
                eventCard.style.transform = 'translateX(-100px)';
                setTimeout(() => {
                    eventCard.remove();
                }, 300);
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const scrollElements = document.querySelectorAll('.scroll-reveal');
            
            const elementInView = (el, scrollOffset = 100) => {
                const elementTop = el.getBoundingClientRect().top;
                return (
                    elementTop <= 
                    (window.innerHeight || document.documentElement.clientHeight) - scrollOffset
                );
            };
            
            const displayScrollElement = (element) => {
                element.classList.add('visible');
            };
            
            const hideScrollElement = (element) => {
                element.classList.remove('visible');
            };
            
            const handleScrollAnimation = () => {
                scrollElements.forEach((el) => {
                    if (elementInView(el, 100)) {
                        displayScrollElement(el);
                    } else {
                        hideScrollElement(el);
                    }
                });
            };
            
            window.addEventListener('scroll', () => {
                handleScrollAnimation();
            });
            
            handleScrollAnimation();
        });

        checkSession();
        loadUserStats();
        loadEvents();
        loadUserEvents();
    </script>
    <!-- Add dashboard.js script before the closing body tag -->
    <script src="js/dashboard.js"></script>
</body>
</html>